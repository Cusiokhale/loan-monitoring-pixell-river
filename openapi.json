{
  "openapi": "3.0.0",
  "info": {
    "title": "Loan Monitoring API",
    "version": "1.0.0",
    "description": "API documentation for the Loan Monitoring application. This API provides endpoints for managing loan applications with role-based access control (user, officer, manager) and user administration.",
    "contact": {
      "name": "API Support",
      "email": "support@loanmonitoring.com"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000/api/v1",
      "description": "API Server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Enter your Firebase JWT token"
      }
    },
    "schemas": {
      "Loan": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique loan identifier",
            "example": "loan123abc"
          },
          "userId": {
            "type": "string",
            "description": "ID of the user who created the loan",
            "example": "user456def"
          },
          "amount": {
            "type": "number",
            "description": "Loan amount requested",
            "example": 50000,
            "minimum": 0
          },
          "purpose": {
            "type": "string",
            "description": "Purpose of the loan",
            "example": "Home renovation"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "under_review",
              "approved",
              "rejected"
            ],
            "description": "Current status of the loan application",
            "example": "pending"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the loan was created",
            "example": "2024-01-15T10:30:00Z"
          },
          "reviewedBy": {
            "type": "string",
            "description": "ID of the officer who reviewed the loan",
            "example": "officer789ghi"
          },
          "approvedBy": {
            "type": "string",
            "description": "ID of the manager who approved/rejected the loan",
            "example": "manager012jkl"
          }
        }
      },
      "CreateLoanRequest": {
        "type": "object",
        "required": [
          "amount",
          "purpose"
        ],
        "properties": {
          "amount": {
            "type": "number",
            "description": "Loan amount requested",
            "example": 50000,
            "minimum": 0
          },
          "purpose": {
            "type": "string",
            "description": "Purpose of the loan",
            "example": "Home renovation",
            "minLength": 1
          }
        }
      },
      "ReviewLoanRequest": {
        "type": "object",
        "required": [
          "notes"
        ],
        "properties": {
          "notes": {
            "type": "string",
            "description": "Review notes from the loan officer",
            "example": "Documents verified, customer has good credit history"
          }
        }
      },
      "ApproveLoanRequest": {
        "type": "object",
        "required": [
          "approved"
        ],
        "properties": {
          "approved": {
            "type": "boolean",
            "description": "Whether the loan is approved or rejected",
            "example": true
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "uid": {
            "type": "string",
            "description": "Unique user identifier",
            "example": "user123abc"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "User email address",
            "example": "user@example.com"
          },
          "role": {
            "type": "string",
            "enum": [
              "user",
              "officer",
              "manager"
            ],
            "description": "User role for authorization",
            "example": "user"
          },
          "customClaims": {
            "type": "object",
            "description": "Custom claims associated with the user",
            "additionalProperties": true
          },
          "metadata": {
            "type": "object",
            "properties": {
              "creationTime": {
                "type": "string",
                "format": "date-time"
              },
              "lastSignInTime": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        }
      },
      "SetUserClaimsRequest": {
        "type": "object",
        "required": [
          "role"
        ],
        "properties": {
          "role": {
            "type": "string",
            "enum": [
              "user",
              "officer",
              "manager"
            ],
            "description": "Role to assign to the user",
            "example": "officer"
          },
          "customClaims": {
            "type": "object",
            "description": "Additional custom claims to set",
            "additionalProperties": true
          }
        }
      },
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Success message",
            "example": "Operation completed successfully"
          },
          "data": {
            "type": "object",
            "description": "Response data"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Error message",
            "example": "Resource not found"
          },
          "code": {
            "type": "string",
            "description": "Error code",
            "example": "NOT_FOUND"
          },
          "status": {
            "type": "string",
            "example": "error"
          }
        }
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Authentication token is missing or invalid",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Unauthorized",
              "code": "UNAUTHORIZED",
              "status": "error"
            }
          }
        }
      },
      "ForbiddenError": {
        "description": "User does not have permission to access this resource",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Forbidden - Insufficient permissions",
              "code": "FORBIDDEN",
              "status": "error"
            }
          }
        }
      },
      "NotFoundError": {
        "description": "The requested resource was not found",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Resource not found",
              "code": "NOT_FOUND",
              "status": "error"
            }
          }
        }
      },
      "BadRequestError": {
        "description": "Invalid request parameters or body",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Invalid request data",
              "code": "BAD_REQUEST",
              "status": "error"
            }
          }
        }
      },
      "InternalServerError": {
        "description": "Internal server error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            },
            "example": {
              "error": "Internal server error",
              "code": "INTERNAL_ERROR",
              "status": "error"
            }
          }
        }
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "Loans",
      "description": "Loan application management endpoints"
    },
    {
      "name": "Admin",
      "description": "User administration and management endpoints"
    },
    {
      "name": "Health",
      "description": "Application health check endpoints"
    }
  ],
  "paths": {
    "/admin/{userId}": {
      "get": {
        "summary": "Get user by ID",
        "description": "Retrieves detailed information about a specific user by their unique ID. Returns user profile including email, role, custom claims, and metadata.",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The unique identifier of the user",
            "example": "user123abc"
          }
        ],
        "responses": {
          "200": {
            "description": "User details retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                },
                "example": {
                  "user": {
                    "uid": "user123abc",
                    "email": "user@example.com",
                    "role": "user",
                    "customClaims": {
                      "role": "user"
                    },
                    "metadata": {
                      "creationTime": "2024-01-10T08:00:00Z",
                      "lastSignInTime": "2024-01-15T10:30:00Z"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/admin/users/{userId}/claims": {
      "post": {
        "summary": "Set custom claims for a user",
        "description": "Assigns or updates custom claims (roles and permissions) for a specific user. Used to manage user authorization levels (user, officer, manager).",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The unique identifier of the user",
            "example": "user123abc"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SetUserClaimsRequest"
              },
              "examples": {
                "setOfficer": {
                  "summary": "Set user as officer",
                  "value": {
                    "role": "officer"
                  }
                },
                "setManager": {
                  "summary": "Set user as manager",
                  "value": {
                    "role": "manager"
                  }
                },
                "setUserWithCustomClaims": {
                  "summary": "Set user with custom claims",
                  "value": {
                    "role": "user",
                    "customClaims": {
                      "department": "finance",
                      "region": "north"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User claims updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "User claims set successfully"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "uid": {
                          "type": "string",
                          "example": "user123abc"
                        },
                        "email": {
                          "type": "string",
                          "example": "user@example.com"
                        },
                        "customClaims": {
                          "type": "object",
                          "example": {
                            "role": "officer"
                          }
                        }
                      }
                    }
                  }
                },
                "example": {
                  "message": "User claims set successfully",
                  "user": {
                    "uid": "user123abc",
                    "email": "user@example.com",
                    "customClaims": {
                      "role": "officer"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequestError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/admin/users": {
      "get": {
        "summary": "List all users",
        "description": "Retrieves a paginated list of all users in the system. Supports pagination with limit and pageToken parameters.",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1000,
              "default": 100
            },
            "description": "Maximum number of users to return per page",
            "example": 50
          },
          {
            "in": "query",
            "name": "pageToken",
            "schema": {
              "type": "string"
            },
            "description": "Token for retrieving the next page of results (returned from previous request)",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
          }
        ],
        "responses": {
          "200": {
            "description": "List of users retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/User"
                      }
                    },
                    "count": {
                      "type": "integer",
                      "description": "Number of users in the current page",
                      "example": 50
                    },
                    "pageToken": {
                      "type": "string",
                      "description": "Token to retrieve the next page of results (if more results exist)",
                      "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
                    }
                  }
                },
                "examples": {
                  "firstPage": {
                    "summary": "First page of users",
                    "value": {
                      "users": [
                        {
                          "uid": "user123abc",
                          "email": "user1@example.com",
                          "role": "user",
                          "customClaims": {
                            "role": "user"
                          },
                          "metadata": {
                            "creationTime": "2024-01-10T08:00:00Z",
                            "lastSignInTime": "2024-01-15T10:30:00Z"
                          }
                        },
                        {
                          "uid": "user456def",
                          "email": "officer@example.com",
                          "role": "officer",
                          "customClaims": {
                            "role": "officer"
                          },
                          "metadata": {
                            "creationTime": "2024-01-08T09:00:00Z",
                            "lastSignInTime": "2024-01-15T14:20:00Z"
                          }
                        },
                        {
                          "uid": "user789ghi",
                          "email": "manager@example.com",
                          "role": "manager",
                          "customClaims": {
                            "role": "manager"
                          },
                          "metadata": {
                            "creationTime": "2024-01-05T07:00:00Z",
                            "lastSignInTime": "2024-01-15T11:45:00Z"
                          }
                        }
                      ],
                      "count": 3,
                      "pageToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/loans": {
      "post": {
        "summary": "Create a new loan application",
        "description": "Allows authenticated users with the 'user' role to submit a new loan application. The loan is created with a 'pending' status.",
        "tags": [
          "Loans"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateLoanRequest"
              },
              "examples": {
                "homeRenovation": {
                  "summary": "Home renovation loan",
                  "value": {
                    "amount": 50000,
                    "purpose": "Home renovation"
                  }
                },
                "businessExpansion": {
                  "summary": "Business expansion loan",
                  "value": {
                    "amount": 100000,
                    "purpose": "Business expansion"
                  }
                },
                "education": {
                  "summary": "Education loan",
                  "value": {
                    "amount": 25000,
                    "purpose": "Education expenses"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Loan created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Loan created successfully"
                    },
                    "loan": {
                      "$ref": "#/components/schemas/Loan"
                    }
                  }
                },
                "example": {
                  "message": "Loan created successfully",
                  "loan": {
                    "id": "loan123abc",
                    "userId": "user456def",
                    "amount": 50000,
                    "purpose": "Home renovation",
                    "status": "pending",
                    "createdAt": "2024-01-15T10:30:00Z"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequestError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get all loan applications",
        "description": "Retrieves a list of loan applications. Officers and managers can view all loans. Supports filtering by status and userId.",
        "tags": [
          "Loans"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "under_review",
                "approved",
                "rejected"
              ]
            },
            "description": "Filter loans by status",
            "example": "pending"
          },
          {
            "in": "query",
            "name": "userId",
            "schema": {
              "type": "string"
            },
            "description": "Filter loans by user ID",
            "example": "user456def"
          }
        ],
        "responses": {
          "200": {
            "description": "List of loans retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "count": {
                      "type": "integer",
                      "description": "Total number of loans matching the criteria",
                      "example": 2
                    },
                    "loans": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Loan"
                      }
                    }
                  }
                },
                "examples": {
                  "allLoans": {
                    "summary": "All loans",
                    "value": {
                      "count": 2,
                      "loans": [
                        {
                          "id": "loan123abc",
                          "userId": "user456def",
                          "amount": 50000,
                          "purpose": "Home renovation",
                          "status": "pending",
                          "createdAt": "2024-01-15T10:30:00Z"
                        },
                        {
                          "id": "loan789ghi",
                          "userId": "user111jkl",
                          "amount": 75000,
                          "purpose": "Business expansion",
                          "status": "under_review",
                          "createdAt": "2024-01-16T14:20:00Z",
                          "reviewedBy": "officer222mno"
                        }
                      ]
                    }
                  },
                  "pendingLoans": {
                    "summary": "Pending loans only",
                    "value": {
                      "count": 1,
                      "loans": [
                        {
                          "id": "loan123abc",
                          "userId": "user456def",
                          "amount": 50000,
                          "purpose": "Home renovation",
                          "status": "pending",
                          "createdAt": "2024-01-15T10:30:00Z"
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/loans/{id}/review": {
      "put": {
        "summary": "Review a loan application",
        "description": "Allows loan officers to review a pending loan application and move it to 'under_review' status. Officers can add review notes during this process.",
        "tags": [
          "Loans"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The unique identifier of the loan to review",
            "example": "loan123abc"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReviewLoanRequest"
              },
              "examples": {
                "positiveReview": {
                  "summary": "Positive review",
                  "value": {
                    "notes": "Documents verified, customer has excellent credit history. Recommending for approval."
                  }
                },
                "needsMoreInfo": {
                  "summary": "Needs additional information",
                  "value": {
                    "notes": "Additional income documentation required before proceeding with approval."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Loan reviewed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Loan reviewed successfully"
                    },
                    "loan": {
                      "$ref": "#/components/schemas/Loan"
                    },
                    "notes": {
                      "type": "string",
                      "example": "Documents verified, customer has good credit history"
                    }
                  }
                },
                "example": {
                  "message": "Loan reviewed successfully",
                  "loan": {
                    "id": "loan123abc",
                    "userId": "user456def",
                    "amount": 50000,
                    "purpose": "Home renovation",
                    "status": "under_review",
                    "createdAt": "2024-01-15T10:30:00Z",
                    "reviewedBy": "officer789ghi"
                  },
                  "notes": "Documents verified, customer has good credit history"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequestError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/loans/{id}/approve": {
      "put": {
        "summary": "Approve or reject a loan application",
        "description": "Allows managers to make a final decision on a loan that is under review. The loan can be either approved or rejected.",
        "tags": [
          "Loans"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The unique identifier of the loan to approve/reject",
            "example": "loan123abc"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApproveLoanRequest"
              },
              "examples": {
                "approve": {
                  "summary": "Approve loan",
                  "value": {
                    "approved": true
                  }
                },
                "reject": {
                  "summary": "Reject loan",
                  "value": {
                    "approved": false
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Loan decision recorded successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Loan approved successfully"
                    },
                    "loan": {
                      "$ref": "#/components/schemas/Loan"
                    }
                  }
                },
                "examples": {
                  "approved": {
                    "summary": "Loan approved",
                    "value": {
                      "message": "Loan approved successfully",
                      "loan": {
                        "id": "loan123abc",
                        "userId": "user456def",
                        "amount": 50000,
                        "purpose": "Home renovation",
                        "status": "approved",
                        "createdAt": "2024-01-15T10:30:00Z",
                        "reviewedBy": "officer789ghi",
                        "approvedBy": "manager012jkl"
                      }
                    }
                  },
                  "rejected": {
                    "summary": "Loan rejected",
                    "value": {
                      "message": "Loan rejected",
                      "loan": {
                        "id": "loan123abc",
                        "userId": "user456def",
                        "amount": 50000,
                        "purpose": "Home renovation",
                        "status": "rejected",
                        "createdAt": "2024-01-15T10:30:00Z",
                        "reviewedBy": "officer789ghi",
                        "approvedBy": "manager012jkl"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequestError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "403": {
            "$ref": "#/components/responses/ForbiddenError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/": {
      "get": {
        "summary": "Root endpoint",
        "description": "Basic endpoint to verify the application is running",
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "Application is running successfully",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string",
                  "example": "Hello, Cordelia! Application is Working!"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Health check endpoint",
        "description": "Returns the health status of the server",
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "Server is healthy and operational",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string",
                  "example": "Server is healthy"
                }
              }
            }
          }
        }
      }
    }
  }
}